<!DOCTYPE html>
<html>
	<head>
	
		<script src="http://ajax.aspnetcdn.com/ajax/jquery/jquery-1.5.1.min.js" type="text/javascript"></script>
	
		<script src="bingMapsKey.js" type="text/javascript"></script>
	
		<script type="text/javascript">
		
			var bingUrl = 'http://dev.virtualearth.net/REST/v1/Locations?query=[address]&key=[key]&jsonp=?';
		
			$(function(){
				$("input[type='button']").click(search);
			});
		
			function search()
			{
				var address = buildAddress();
			
				// build up the url
				var url = bingUrl;
				url = url.replace('[address]', address);
				url = url.replace('[key]', key);	
				
				$("#results").empty();
				
				// make the remote call
				$.getJSON(url,function(result){
					$.each(result.resourceSets, function(index,item){
						
						var obj = item.resources[0];
						var addr = obj.address;
						
						var addrContainer = $("<fieldset>");
						var list = $("<ul>");
						list.append($("<li>").html(addr.addressLine));
						list.append($("<li>").html(addr.locality));
						list.append($("<li>").html(addr.adminDistrict));
						list.append($("<li>").html(addr.postalCode));
						list.append($("<li>").html(addr.countryRegion));
						
						addrContainer.append(list);
						$("#results").append(addrContainer);
					});
				});
			}
		
			function buildAddress()
			{
				// build up the address
				var address = '';
				
				var addressLine = $("#addressLine").val();
				var city = $("#city").val();
				var state = $("#state").val();
				var zip = $("#zip").val();
				var country = $("#country").val();
				
				if (addressLine != "")
				{
					address += addressLine;
				}
				
				if (city != "")
				{
					address += address == "" ? city : ", " + city;
				}
				
				if (state != "")
				{
					address += address == "" ? state : ", " + state;
				}
				
				if (zip != "")
				{
					address += address == "" ? zip : ", " + zip;
				}
				
				if (country != "")
				{
					address += address == "" ? country : ", " + country;
				}
			
				return address;
			}
		</script>
	
		<style type="text/css">
		
			ul { list-style:none; }
			ul li { margin-bottom: .5em; }
			.label { display:inline-block; width: 150px;}
			.value { display:inline-block; }
		
		</style>
	
	</head>
	
	<body>
		<div id="search">
		
			<ul>
				<li><div class="label">Address Line:</div>
					<div class="value"><input type="text" id="addressLine"/></div>
				</li>
				<li><div class="label">City:</div>
					<div class="value"><input type="text" id="city"/></div>
				</li>
				<li><div class="label">State:</div>
					<div class="value"><input type="text" id="state"/></div>
				</li>
				<li><div class="label">Zip:</div>
					<div class="value"><input type="text" id="zip"/></div>
				</li>
				<li><div class="label">Country Code:</div>
					<div class="value"><input type="text" id="country"/></div>
				</li>		
				<li><div class="label">&nbsp;</div>
					<div class="value"><input type="button" value="search"a></div>
				</li>
			</ul>
		
		</div>
	
		<div id="results">
		</div>
	</body>
</html>